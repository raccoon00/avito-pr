# Сервис назначения Ревьюверов для Pull Request'ов

Микросервис для автоматического назначения ревьюверов на Pull Request'ы и управления командами разработки.

## Сборка и запуск

### Быстрый запуск с Makefile

```bash
# Сборка и запуск всех сервисов
# (Нужен установленный go и docker)
make run

# Просмотр логов
make logs

# Запуск интеграционных тестов
make test

# Очистка и перезапуск
make auto_test

# Остановка сервисов
make clean_down
```

### Ручная сборка и запуск

#### Сборка приложения
```bash
GOOS=linux CGO_ENABLED=0 go build -o bin/restapi ./cmd/restapi
```

#### Запуск с Docker Compose
```bash
# Используя стандартный .env файл
docker compose up --build -d

# Используя другой .env файл
docker compose --env-file .env.production up --build -d
```

#### Интеграционные тесты
```bash
# Запуск сервиса (требуется для тестов)
docker compose up -d

# Запуск тестов
go test -count=1 ./tests

# Запуск конкретного теста
go test -count=1 ./tests -run TestTeamAdd
```

## Описание структуры проекта

```
avito-pr/
├── cmd/restapi/           # Точка входа приложения
├── internal/
│   ├── adapter/           # Адаптеры для внешних систем
│   │   ├── http/          # HTTP хендлеры и роутинг (Gin)
│   │   └── postgres/      # Репозитории для PostgreSQL (pgx)
│   ├── app/               # Инициализация приложения, подвязывание адаптеров
│   ├── config/            # Конфигурация (через переменные среды)
│   ├── domain/            # Доменные модели и ошибки
│   └── service/           # Бизнес-логика и интерфейсы
├── migrations/            # Миграции базы данных
├── tests/                 # Интеграционные тесты
├── api/                   # API спецификация (OpenAPI) + тех задание
├── bin/                   # Скомпилированные бинарники
├── Makefile               # Скрипты сборки и запуска
├── docker-compose.yml     # Конфигурация Docker Compose
├── Dockerfile             # Конфигурация Docker для сервиса
└── go.mod                 # Зависимости Go
```

### Основные компоненты

- **HTTP API**: RESTful API реализованное с помощью `Gin`
- **PostgreSQL**: Запущена отдельным сервисом, взаимодействие с помощью `pgx`
- **Domain**: Структуры для бизнес-логики
- **Service**: Реализация бизнес-логика в отрыве от конкретных адаптеров
- **Интеграционные сервисы**: Полные тесты всех эндпоинтов

### Доступные эндпоинты

Были реализованы все обязательные эндпоинты:
- `POST /team/add` - Создание команды с участниками
- `GET /team/get` - Получение команды по имени
- `POST /users/setIsActive` - Установка активности пользователя
- `POST /pullRequest/create` - Создание PR с автоматическим назначением ревьюверов
- `POST /pullRequest/reassign` - Переназначение ревьювера
- `POST /pullRequest/merge` - Мердж PR (идемпотентная операция)
- `GET /users/getReview` - Получение PR, назначенных пользователю для ревью
